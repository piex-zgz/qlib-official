
# ğŸ—ï¸ Deep Research Agent æ¶æ„ç™½çš®ä¹¦

##

### 1. æ ¸å¿ƒè®¾è®¡å“²å­¦

"Trust but Verify" (ä¿¡ä»»ä½†éªŒè¯)

* **Trust**: LLM ä»æ–°é—»ä¸­æå–çš„é€»è¾‘çº¿ç´¢ã€‚
* **Verify**: ä½¿ç”¨å®æ—¶è¡Œæƒ…æ•°æ®ï¼ˆAkshareï¼‰éªŒè¯è¯¥çº¿ç´¢æ˜¯å¦å·²è¢«å¸‚åœºå®šä»·ï¼ˆPrice-inï¼‰æˆ–èƒŒç¦»ã€‚
* **Decision**: åªæœ‰å½“ **é€»è¾‘ + æ•°æ®** å…±æŒ¯æ—¶ï¼Œæ‰ç”Ÿæˆäº¤æ˜“ä¿¡å·ã€‚

### 2. ç³»ç»Ÿæ¶æ„å›¾ (System Architecture)

ç³»ç»Ÿåˆ†ä¸ºä¸‰å±‚ï¼š**æ„ŸçŸ¥å±‚ (Perception)**ã€**å·¥å…·å±‚ (Tools)**ã€**å†³ç­–å±‚ (Decision)**ã€‚

```mermaid
graph TD
    %% Data Source
    News[æ•°æ®æº: è´¢ç»æ–°é—»æµ] --> Scanner

    %% Layer 1: Perception (æ„ŸçŸ¥ä¸åˆç­›)
    subgraph "Layer 1: Perception (æ„ŸçŸ¥å±‚)"
        Scanner[Scanner Agent<br/>(LLMåˆç­›)]
        Filter[è§„åˆ™/å‘é‡å»é‡]
        News --> Filter
        Filter --> Scanner
        Scanner -->|è¾“å‡º: é«˜ä»·å€¼çº¿ç´¢| Hypothesis[äº¤æ˜“å‡è®¾<br/>(åˆ©å¥½æ¿å—X)]
    end

    %% Layer 2: Tools (å·¥å…·å±‚ - æ™ºèƒ½ä½“çš„æ‰‹)
    subgraph "Layer 2: Tools (å·¥å…·ç®±)"
        T_Map[Tool: Sector Mapper<br/>(æ¿å— -> è‚¡ç¥¨ä»£ç )]
        T_Data[Tool: Market Data<br/>(Akshare è¡Œæƒ…è·å–)]
        T_Tech[Tool: Technical Calc<br/>(è®¡ç®— RSI/å‡çº¿/ä¼°å€¼)]
        
        Hypothesis --> T_Map
        T_Map -->|è¾“å‡º: 600xxx| T_Data
        T_Data --> T_Tech
    end

    %% Layer 3: Decision (å†³ç­–å±‚ - æ™ºèƒ½ä½“çš„å¤§è„‘)
    subgraph "Layer 3: Reasoner (æ·±åº¦ç ”åˆ¤)"
        Context[ç»¼åˆä¸Šä¸‹æ–‡<br/>(æ–°é—» + å®æ—¶ä»·æ ¼ + æŠ€æœ¯æŒ‡æ ‡)]
        Brain[Researcher Agent<br/>(LLM æ·±åº¦æ¨ç†)]
        
        T_Tech -->|è¾“å‡º: å®¢è§‚æ•°æ®æŠ¥å‘Š| Context
        Hypothesis --> Context
        Context --> Brain
        Brain -->|è¾“å‡º: æœ€ç»ˆè£å†³| Signal{äº¤æ˜“ä¿¡å·}
    end

    Signal -- LONG/SHORT --> Execution[Qlib å›æµ‹/å®ç›˜]

```

---

### 3. æ¨¡å—æ¸…å•ä¸æ–‡ä»¶è§„åˆ’

æˆ‘ä»¬éœ€è¦åœ¨ `my-quant/news` ä¸‹å»ºç«‹è§„èŒƒçš„æ–‡ä»¶å¤¹ç»“æ„ï¼š

```text
my-quant/news/
â”œâ”€â”€ agent/                  # [æ ¸å¿ƒ] æ™ºèƒ½ä½“é€»è¾‘
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ scanner.py          # è´Ÿè´£å¿«é€Ÿé˜…å·ï¼Œç­›é€‰æ–°é—»
â”‚   â””â”€â”€ researcher.py       # è´Ÿè´£æ·±åº¦ç ”åˆ¤ï¼Œè°ƒç”¨å·¥å…·åšå†³ç­–
â”œâ”€â”€ tools/                  # [åŸºç¡€] å·¥å…·ç®± (Akshareå°è£…)
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ data_fetcher.py     # è·å–è¡Œæƒ… (ä»·æ ¼, PE, æ¶¨è·Œå¹…)
â”‚   â”œâ”€â”€ sector_mapper.py    # æ¦‚å¿µæ˜ å°„ (æ¿å—å -> è‚¡ç¥¨åˆ—è¡¨)
â”‚   â””â”€â”€ tech_indicators.py  # æŠ€æœ¯æŒ‡æ ‡è®¡ç®— (RSI, MA, MACD)
â”œâ”€â”€ config/                 # [é…ç½®]
â”‚   â””â”€â”€ config.yaml         # API Key, é˜ˆå€¼è®¾ç½®
â””â”€â”€ main_agent.py           # [å…¥å£] å¯åŠ¨è„šæœ¬

```

---

### 4. å¼€å‘è·¯çº¿å›¾ (Roadmap)

æˆ‘ä»¬å°†æŒ‰é¡ºåºæ‰§è¡Œä»¥ä¸‹ **4 ä¸ªé˜¶æ®µ**ã€‚æ¯ä¸ªé˜¶æ®µéƒ½æ˜¯ç‹¬ç«‹çš„ã€å¯æµ‹è¯•çš„ã€‚

#### âœ… Phase 1: æ„å»ºâ€œå·¥å…·ç®±â€ (Building the Toolbox)

**ç›®æ ‡**ï¼šè®© Agent æ‹¥æœ‰â€œçœ‹ç›˜â€çš„èƒ½åŠ›ã€‚å¦‚æœæ²¡æœ‰è¿™ä¸€æ­¥ï¼ŒLLM å°±æ˜¯çå­ã€‚

* **ä»»åŠ¡ 1.1 (`tools/sector_mapper.py`)**:
* å®ç° `get_stocks_by_concept(name)`ã€‚
* åŠŸèƒ½ï¼šè¾“å…¥ "äººå½¢æœºå™¨äºº"ï¼Œè¿”å› `['002050', '603583'...]`ã€‚
* *æŠ€æœ¯éš¾ç‚¹*ï¼šåˆ©ç”¨ Akshare çš„æ¦‚å¿µæ¥å£æˆ–ç»´æŠ¤é™æ€æ˜ å°„è¡¨ã€‚

* **ä»»åŠ¡ 1.2 (`tools/data_fetcher.py`)**:
* å®ç° `get_stock_snapshot(code)`ã€‚
* åŠŸèƒ½ï¼šè¾“å…¥è‚¡ç¥¨ä»£ç ï¼Œè¿”å› `å½“å‰ä»·`ã€`ä»Šæ—¥æ¶¨å¹…`ã€`PE(TTM)`ã€`æ¢æ‰‹ç‡`ã€‚

* **ä»»åŠ¡ 1.3 (`tools/tech_indicators.py`)**:
* å®ç° `calculate_indicators(history_df)`ã€‚
* åŠŸèƒ½ï¼šè®¡ç®— RSI(14)ã€å‡çº¿åç¦»åº¦ã€å†å²åˆ†ä½æ•°ï¼ˆåˆ¤æ–­æ˜¯å¦é«˜ä½ï¼‰ã€‚

#### â³ Phase 2: æ„å»ºâ€œæ„ŸçŸ¥å±‚â€ (The Scanner)

**ç›®æ ‡**ï¼šä»æµ·é‡å™ªéŸ³ä¸­æå–çº¿ç´¢ï¼Œä¸è¦è®©åé¢çš„æ·±åº¦æ€è€ƒæµªè´¹åœ¨åƒåœ¾æ–°é—»ä¸Šã€‚

* **ä»»åŠ¡ 2.1 (`agent/scanner.py`)**:
* ç§»æ¤æˆ‘ä»¬è¦ä¹‹å‰å†™çš„ `BalancedAnalyst` é€»è¾‘ã€‚
* åŠŸèƒ½ï¼šè¾“å…¥ 20 æ¡æ–°é—»ï¼Œè¾“å‡º `[{"title": "...", "sector": "å·¥ç¨‹æœºæ¢°"}]`ã€‚
* *å‡çº§*ï¼šåªè´Ÿè´£â€œæ‰¾çº¿ç´¢â€ï¼Œä¸å†è´Ÿè´£â€œä¸‹ç»“è®ºâ€ã€‚

#### â³ Phase 3: æ„å»ºâ€œå¤§è„‘â€ (The Researcher)

**ç›®æ ‡**ï¼šè¿™æ˜¯æœ€å¤æ‚çš„é€»è¾‘ï¼Œæ¨¡æ‹ŸåŸºé‡‘ç»ç†çš„å†³ç­–è¿‡ç¨‹ã€‚

* **ä»»åŠ¡ 3.1 (`agent/researcher.py`)**:
* ç¼–å†™ `DeepReasoning` Promptã€‚
* é€»è¾‘ï¼š

1. æ¥æ”¶ Scanner çš„çº¿ç´¢ã€‚
2. è°ƒç”¨ Tool 1.1 æ‰¾åˆ°è‚¡ç¥¨ã€‚
3. è°ƒç”¨ Tool 1.2 & 1.3 æ‹¿åˆ°æ•°æ®ã€‚
4. **åˆæˆ Prompt**ï¼šâ€œæ–°é—»è¯´åˆ©å¥½ï¼Œä½†æ•°æ®æ˜¾ç¤º RSI=90 ä¸” PE=100ï¼Œè¯·åˆ¤æ–­ã€‚â€
5. è¾“å‡ºæœ€ç»ˆ JSONã€‚

#### â³ Phase 4: é›†æˆä¸å·¥ä½œæµ (Integration)

**ç›®æ ‡**ï¼šä¸€é”®è¿è¡Œï¼Œè¾“å‡º Qlib å¯ç”¨çš„å› å­æ–‡ä»¶ã€‚

* **ä»»åŠ¡ 4.1 (`main_agent.py`)**:
* ä¸²è”æ•´ä¸ªæµç¨‹ï¼š`News -> Scanner -> Loop(Tools -> Researcher) -> CSV`ã€‚
* ç”Ÿæˆ `sentiment_factor.csv`ã€‚

---

### 5. æˆ‘ä»¬ç°åœ¨çš„è¡ŒåŠ¨æŒ‡ä»¤

**ç«‹åˆ»å¼€å§‹ Phase 1 (æ„å»ºå·¥å…·ç®±)ã€‚**

è¿™æ˜¯åœ°åŸºã€‚å¦‚æœè¿â€œæŸ¥è¯¢å…‰é€šä¿¡æ¿å—æœ‰å“ªäº›è‚¡ç¥¨â€æˆ–è€…â€œæŸ¥è¯¢ä¸­é™…æ—­åˆ›ç°åœ¨çš„RSIæ˜¯å¤šå°‘â€éƒ½åšä¸åˆ°ï¼ŒAgent å°±æ— æ³•å·¥ä½œã€‚

**æˆ‘å»ºè®®å…ˆå†™ `tools/sector_mapping.py`ã€‚**
ç†ç”±ï¼šLLM è¾“å‡ºçš„æ˜¯è‡ªç„¶è¯­è¨€ï¼ˆå¦‚â€œä½ç©ºç»æµâ€ï¼‰ï¼Œè€Œäº¤æ˜“ç³»ç»Ÿåªè®¤ä»£ç ï¼ˆå¦‚ `sz002085`ï¼‰ã€‚è¿™æ˜¯è¿æ¥ AI å’Œ é‡åŒ– çš„ç¬¬ä¸€åº§æ¡¥æ¢ã€‚

**ä½ åŒæ„å…ˆå¼€å‘è¿™ä¸ªæ˜ å°„å·¥å…·å—ï¼Ÿ** å¦‚æœåŒæ„ï¼Œæˆ‘é©¬ä¸Šç»™ä½ ä»£ç ã€‚
